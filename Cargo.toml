[package]
name = "tiny_os"
version = "0.4.0"
authors = ["jungamer-64 <your.email@example.com>"]
edition = "2024"
default-run = "tiny_os"
description = "Minimal x86_64 no_std Rust kernel with robust hardware support"
license = "MIT OR Apache-2.0"
repository = "https://github.com/jungamer-64/OS"
keywords = ["os", "kernel", "no-std", "bare-metal", "x86_64"]
categories = ["no-std", "embedded", "os"]

# Workspace disabled to avoid dependency conflicts
# [workspace]
# members = ["builder"]

[package.metadata]
description = "Minimal x86_64 no_std Rust kernel with robust hardware support"
keywords = ["os", "kernel", "no-std", "bare-metal", "x86_64"]
categories = ["no-std", "embedded", "os"]

[lib]
name = "tiny_os"
path = "src/lib.rs"

[[bin]]
name = "tiny_os"
path = "src/main.rs"

[features]
# Feature to enable standard library unit tests (not compatible with no_std kernel)
# These tests require std features like Vec, String, and the test crate
std-tests = []

# Feature to enable syscall tracing in debug builds
# Usage: cargo build --features syscall_trace
syscall_trace = []

# Feature to enable usermode execution test (Phase 1)
# Usage: cargo build --features test_usermode
test_usermode = []

[dependencies]
# Bootloader API for kernel (v0.11)
bootloader_api = "=0.11.10"

# x86_64 specific types and instructions
x86_64 = "0.15.2"

# Spin-based synchronization primitives (no_std compatible)
spin = "0.9.8"

# Lazy static initialization with spin locks
lazy_static = { version = "1.5.0", features = ["spin_no_std"] }

# Heap allocator
# Heap allocator
linked_list_allocator = "0.10.5"

# Keyboard scancode decoder
pc-keyboard = "0.7.0"

# Bootloader (for bootimage compatibility)
bootloader = { version = "0.9.23", features = ["map_physical_memory"] }

[build-dependencies]
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"

[profile.dev]
# Abort on panic (no unwinding in kernel space)
panic = "abort"

# Enable overflow checks even in dev builds (safety)
overflow-checks = true

# Enable debug assertions
debug-assertions = true

[profile.release]
# Abort on panic (no unwinding in kernel space)
panic = "abort"

# Fat LTO for maximum optimization across crates
lto = "fat"

# Optimize for performance (benchmarks will guide further tuning)
opt-level = 3

# Strip debug symbols in release
strip = true

# Enable overflow checks in release (safety over speed)
overflow-checks = true

# Codegen units = 1 for better optimization
codegen-units = 1

# Enable additional optimizations
# Note: Some of these are enabled by default at opt-level 3
# but we make them explicit for documentation

[profile.test]
# Use abort even in tests for consistency
panic = "abort"

# Enable overflow checks in tests
overflow-checks = true

# ============================================================================
# Linting Configuration (via Cargo.toml metadata)
# ============================================================================

# Note: These settings are enforced via #![deny(...)] in source files
# Listed here for documentation purposes

# Denied lints (errors):
# - unsafe_op_in_unsafe_fn: Require explicit unsafe blocks
# - missing_debug_implementations: All public types should be debuggable

# Warned lints:
# - missing_docs: Public items should be documented
# - unused_must_use: Results should be handled
# - rust_2018_idioms: Follow modern Rust conventions
